### **Название задачи:** MVP системы мониторинга свиноводческих ферм (PigMonitoring). Задание 2: Проработка контейнеров (C2).
### **Автор:** Александр Сосорев
### **Дата:** 07.02.2026

### **Функциональные требования**
Ключевые сценарии использования системы на уровне контейнеров.

| **№** | **Действующие лица или системы**            | **Use Case**                                 | **Описание**                                                                                                                                          |
|:------|:--------------------------------------------|:---------------------------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1     | Видеокамера, Edge Agent, Дежурный сотрудник | Обнаружение инцидента и локальное оповещение | Видеопоток анализируется локально; при обнаружении драки или задавливания сигнал отправляется сотруднику по локальной сети через WebSockets или MQTT. |
| 2     | Edge Agent, IoT-устройства                  | Автоматизация кормления и поения             | Агент собирает данные о весе корма и состоянии воды через локальный брокер и управляет оборудованием по протоколам MQTT/Modbus.                       |
| 3     | Sync Service, Cloud API, Corporate Kafka    | Отложенная синхронизация метрик              | Накопленные за время отсутствия связи данные пакетно передаются в облако и далее в общекорпоративную шину данных для аналитики.                       |
| 4     | Оператор, Cloud API, Edge Agent             | Дистанционная конфигурация                   | Оператор меняет параметры чувствительности камер или графики кормления; настройки синхронизируются с конкретным агентом при наличии связи.            |

### **Нефункциональные требования**
Архитектурно значимые требования к контейнерам и протоколам.

| **№** | **Требование**                                                                                                      |
|:------|:--------------------------------------------------------------------------------------------------------------------|
| 1     | **Производительность:** Время от момента возникновения ситуации до оповещения — не более 5 секунд.                  |
| 2     | **Автономность:** Полная функциональность мониторинга и управления оборудованием при отсутствии внешнего интернета. |
| 3     | **Ресурсоэффективность:** Оптимизация потребления ресурсов на Edge-серверах для стабильной работы AI-моделей.       |
| 4     | **Совместимость:** Поддержка видеокамер и кормушек разных производителей (Multi-vendor).                            |

### **Решение**
Архитектура детализирована до уровня контейнеров (C2) с акцентом на распределенную обработку данных (Edge Computing).

**Обоснование технологического стека:**
1.  **Стек разработки (Go):** Контейнеры Агента реализуются на языке Go для обеспечения высокой производительности и низкого потребления RAM на Edge-устройствах.
2.  **Локальный брокер сообщений (RabbitMQ):** Выбран для взаимодействия с IoT-устройствами на ферме. Преимущества: встроенная поддержка MQTT, легковесность по сравнению с Kafka и надежная работа в кластерах.
3.  **Протоколы взаимодействия (gRPC):** Передача кадров между Video Processor и AI Inference реализована через gRPC. Бинарная сериализация Protobuf минимизирует задержки, помогая уложиться в 5 секунд отклика.
4.  **Хранение данных (PostgreSQL):** PostgreSQL используется как в облаке, так и локально на фермах для консистентности со стеком компании AgroTech X и возможности хранения сложных структур данных.
5.  **Локальные уведомления (WebSockets):** Реализованы для мгновенного Push-оповещения мобильного приложения сотрудника через локальный Wi-Fi в обход облака.

### **Альтернативы**
**Вариант: Использование Kafka на Edge-серверах**
* **Описание:** Развертывание Apache Kafka на каждой ферме для сбора телеметрии.
* **Причина отказа:** Высокие требования Kafka к ресурсам (JVM, диск) избыточны для локальных задач одной фермы. RabbitMQ эффективнее справляется с MQTT-трафиком от датчиков.

**Вариант: Синхронизация данных через REST-запросы**
* **Причина отказа:** Постоянные HTTP-вызовы создают накладные расходы. Выбран паттерн Transactional Outbox (Локальное накопление событий в БД с последующей гарантированной выгрузкой) с пакетной отправкой (Sync Service) для экономии трафика при нестабильном Wi-Fi.

### **Недостатки, ограничения, риски**
* **Сложность эксплуатации:** Управление распределенным парком из 150+ баз данных и брокеров требует внедрения средств автоматизации и мониторинга.
* **Радиус действия:** Локальные уведомления зависят от стабильности и покрытия Wi-Fi сети внутри фермы.
* **Инфраструктурные затраты:** Необходимость закупки и обслуживания надежного серверного оборудования для каждой локальной точки (Edge).